<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Hello, world!</title>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>




  <body>
      <script>
        /*
        var xhttp;
        if (window.XMLHttpRequest) {
            xhttp = new XMLHttpRequest(); 
        } else {    // code for IE6, IE5
            xhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        */

/*         function loadDoc() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
              if (xhttp.readyState == 4 && xhttp.status == 200) {
                document.getElementById("testAjax").innerHTML = xhttp.responseText;
              }
            };
            xhttp.open("GET", "http://127.0.0.1:5000/patient", true);
            xhttp.send();
            console.log("function run");
        } */

        var patientId = '5d9e47ea1d578d2721c8067c';
        
        var getPatients = function(patient_id){
            
            let url_send = "http://127.0.0.1:5000/patients";
            if (undefined != patient_id){
                url_send = "http://127.0.0.1:5000/patients/" + patient_id; 
            }

            $.ajax({
                url: url_send,
                method:"GET",
                crossDomain:true,
                success:function(data){ 
                    
                    let strDisplay = "";
                    for (let i = 0; i< data.length; ++i) {
                        strDisplay += "<div>" + "Patient Item : " + i + "</div>";
                        strDisplay += "<div>" + "ID : " + data[i]._id + "</div>";
                        strDisplay += "<div>" + "First Name : " + data[i].first_name + "</div>";
                        strDisplay += "<div>" + "Last Name : " + data[i].last_name + "</div>";
                        strDisplay += "<div>" + "Address : " + data[i].address + "</div>";
                        strDisplay += "<div>" + "Sex : " + data[i].sex + "</div>";
                        strDisplay += "<div>" + "Date of birth : " + data[i].date_of_birth + "</div>";
                        strDisplay += "<div>" + "Department : " + data[i].department + "</div>";
                        strDisplay += "<div>" + "Doctor : " + data[i].doctor + "</div>";
                        strDisplay += "<br>";
                    }

                    $("#div_result").html(strDisplay);
                }
            }).fail(function(){
                $("#div_result").html("error");
            });
            console.log("getPatients");
        }

        var getAllRecordsByPatientID = function(patient_id){
            
            $.ajax({
                url: "http://127.0.0.1:5000/patients/" + patient_id + "/records",
                method:"GET",
                crossDomain:true,
                success:function(data){
                    
                    let strDisplay = "";
                    for (let i = 0; i< data.length; ++i) {
                        strDisplay += "<div>" + "Record Item : " + i + "</div>";
                        strDisplay += "<div>" + "Date : " + data[i].date + "</div>";
                        strDisplay += "<div>" + "Time : " + data[i].time + "</div>";
                        strDisplay += "<div>" + "Type : " + data[i].type + "</div>";
                        strDisplay += "<div>" + "Value : " + data[i].value + "</div>";
                        strDisplay += "<br>";
                    }

                    $("#div_result").html(strDisplay);
                }
            }).fail(function(){
                $("#div_result").html("error");
            });
            console.log("getAllRecordsByPatientID");
        }

        var postPatient = function() {
            // Create a data to post here.
            // Or you could modify function with an argument like function(form)
            let form = new FormData();
            form.append("first_name", "irene");
            form.append("last_name", "oh");
            form.append("address", "28");
            form.append("date_of_birth", "19831129");
            form.append("department", "phsics");
            form.append("doctor", "John");
            form.append("sex", "F");

            let settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://127.0.0.1:5000/patients",
                "method": "POST",
                "processData": false,
                "contentType": false,
                "mimeType": "multipart/form-data",
                "data": form
            }

            $.ajax(settings).done(function (response) {
                alert("A data is posted!!");
                console.log(response);
            });
        }

        var putPatient = function(patient_id) {
            // Create a data to post here.
            // Or you could modify function with an argument like function(form)
            let form = new FormData();
            //form.append("first_name", "irene");
            //form.append("last_name", "oh");
            form.append("address", "28");
            form.append("date_of_birth", "19830921");
            //form.append("department", "phsics");
            //form.append("doctor", "John");
            //form.append("sex", "F");

            let settings = {
                "async": true,
                "crossDomain": true,
                url: "http://127.0.0.1:5000/patients/" + patient_id,
                method: "PUT",
                "processData": false,
                "contentType": false,
                "mimeType": "multipart/form-data",
                "data": form
            }


            // Trying with JSON - not work for now.
            /* 
            let data_send = {
                address: "29",
                date_of_birth: "19830921"
            }

            let settings = {
                async: true,
                crossDomain: true,
                url: "http://127.0.0.1:5000/patients/" + patient_id,
                method: "PUT",
                //data: JSON.stringify(data_send),
                data: data_send,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
            }
             */
            

            $.ajax(settings).done(function (response) {
                alert("A data is changed!!");
                console.log(response);
            });
        }
    </script>   



    
    <h1>Hello, world!</h1>

    
    <button type="button" class="btn btn-secondary" onclick="getPatients()">getAllPatients</button>
    <button type="button" class="btn btn-secondary" onclick="getPatients(patientId)">getPatientByID</button>
    <button type="button" class="btn btn-secondary" onclick="getAllRecordsByPatientID(patientId);">getAllRecordsByPatientID</button>
    <button type="button" class="btn btn-secondary" onclick="postPatient()">postPatient</button>
    
    <button type="button" class="btn btn-secondary" onclick="putPatient(patientId)">putPatient</button>

    <div id="div_result">   </div>
    

    
  </body>
</html>